<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet'/>
<link rel="stylesheet" href="https://use.typekit.net/baq4vky.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.js"></script>
<div id="map" style="height: 100vh; width: 100vw; position: fixed; top: 0; left: 0"></div>
<div id="tooltip" style="position: absolute; z-index: 1; pointer-events: none;"></div>

<script>
    mapboxgl.accessToken = 'pk.eyJ1IjoicmVpbnZkd29lcmQiLCJhIjoiY2sxNHN6aWIzMGxhdjNjbTloNTA1cm5xZyJ9.KvfYNJxIEIC6bugBFgp_Pw'

    async function init() {
        const data = []

        for (const datum of data) {
            datum.coordinates = [Number(datum.lng), Number(datum.lat)]
        }

        var map = new mapboxgl.Map({
            style: 'mapbox://styles/reinvdwoerd/ck1nk78qw0yeu1cmox9kil9fr/draft',
            center: [4.900, 52.309],
            zoom: 11.67,
            pitch: 40,
            bearing: 0,
            container: 'map',
            antialias: true
        });

        map.on('load', () => {
            map.addLayer({
                'id': '3d-buildings',
                'source': 'composite',
                'source-layer': 'building',
                'filter': ['==', 'extrude', 'true'],
                'type': 'fill-extrusion',
                'minzoom': 13,
                'paint': {
                    'fill-extrusion-color': 'black',

                    // use an 'interpolate' expression to add a smooth transition effect to the
                    // buildings as the user zooms in
                    'fill-extrusion-height': [
                        "interpolate", ["linear"], ["zoom"],
                        15, 0,
                        15.05, ["get", "height"]
                    ],
                    'fill-extrusion-base': [
                        "interpolate", ["linear"], ["zoom"],
                        15, 0,
                        15.05, ["get", "min_height"]
                    ],
                    'fill-extrusion-opacity': .3
                }
            })

            data.forEach(function (marker) {
                var el = $(`
					  	<div class="marker">
					  		<div class="circle"></div>
					  		<div class="label">${marker['educational-institution']}</div>
					  	</div>
					  `)


                // make a marker for each feature and add to the map
                new mapboxgl.Marker(el[0])
                    .setLngLat(marker.coordinates)
                    .addTo(map);
            })

            const marker = label =>
                $(`<div class="marker ${label}">
                     <div class="circle"></div>
                     <div class="label">${label}</div>
                   </div>`)[0];

            new mapboxgl.Marker(marker("End"))
                .setLngLat([4.870, 52.2532])
                .addTo(map);

            new mapboxgl.Marker(marker("Start"))
                .setLngLat([4.90465, 52.3592])
                .addTo(map);

            const currentLocationMarker =
                new mapboxgl.Marker(marker("Current"))
                    .setLngLat([6.0921, 52.5116])
                    .addTo(map);

            /**
             * Tracking
             */
            if (navigator.geolocation) {
                navigator.geolocation.watchPosition(updatePosition, printError);
                navigator.geolocation.getCurrentPosition(updatePosition, printError);
            } else {
                alert("Geolocation is not supported by this browser.")
            }

            function updatePosition(pos) {
                currentLocationMarker.setLngLat([pos.coords.longitude, pos.coords.latitude])
            }

            function printError(error) {
                alert(JSON.stringify(error))
            }
        })
    }

    init()
</script>

<style>
    .mapboxgl-map {
        font-family: unset !important;
    }

    .marker .label {
        top: 11px;
        /*left: calc(-50% + 4px);*/
        position: relative;
        font-size: 13px;
        font-family: futura-pt;
        color: white;
        opacity: .8;
    }

    .marker.Start .label {
        top: -31px;
    }

    .marker .circle {
        background-color: #5285f9;
        width: 12px;
        height: 12px;
        position: relative;
        top: 6px;
        left: 6px;
        border-radius: 50%;
        cursor: pointer;
    }

    .marker .circle::after {
        background-color: rgba(82, 128, 244, 0.5);
        width: 18px;
        height: 18px;
        border-radius: 50%;
        cursor: pointer;
        position: absolute;
        display: block;
        content: ' ';
        margin: auto;
        top: -3px;
        left: -3px;
        animation: pulse 1s infinite alternate;
    }
    
    @keyframes pulse {
        from {
            transform: scale(1);
        }
        
        to {
            transform: scale(1.2);
        }
    }
</style>
</div>
</div>