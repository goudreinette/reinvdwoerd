<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<video playsinline="" muted="" loop="" class="video-obj no-mejs"><source type="video/mp4" src="http://ludwig.vdwoerd.com/wp-content/uploads/2018/04/PPF-blinking-dot-fade.mp4"></video>
<div id="vis">
    <audio
            @ended="showPlayButton"
            ref="audio"
           volume="1"
           autoplay src="./ludwig met intro.wav"></audio>

    <div class="points">

        <div class="point"
             :class="v - lastFrequencyData[i] > 50 ? 'big' : 'small'"
             v-for="(v, i) in frequencyData.reverse()"
             :style="{transform: `scale(${v/100})`}">
        </div>
    </div>
</div>





<script>
    window.$vis = new Vue({
        el: '#vis',
        data() {
            return {
                frequencyData: new Uint8Array(300),
                lastFrequencyData: new Uint8Array(300),
            }
        },

        mounted() {
            this.audio = this.$refs.audio
            var audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            var audioSrc = audioCtx.createMediaElementSource(this.audio);
            this.analyser = audioCtx.createAnalyser();

            // Bind our analyser to the media element source.
            audioSrc.connect(this.analyser);
            audioSrc.connect(audioCtx.destination);

            // this.audio.play()
            this.update()
        },

        methods: {
            showPlayButton () {
                $('#ghost').removeClass('hidden')
            },
            update() {
                this.lastFrequencyData = this.frequencyData.reverse()
                var data = new Uint8Array(25)
                this.analyser.getByteFrequencyData(data);
                // console.log(this.frequencyData)
                this.frequencyData = data
                requestAnimationFrame(() => this.update())
            }
        }
    })
</script>


<style>

body {
    background: magenta;
}

    #vis {
        position: absolute;
        top: 0;
        width: 50vw;
        left: 0;
        height: 50vh;
        right: 0;
        margin: auto;
        top: 0;
        bottom: 0;
        /* height: 100vh; */
        /* display: flex; */
        /* flex-direction: column; */
        /* justify-content: center; */
        color: black;
        display: flex;
        /* background: black; */
        align-items: center;
        flex-wrap: wrap;
        /* display: none !important; */
        z-index: 10000;
        justify-content: space-around;
    }

    #vis .points {
        align-items:;
        display: flex;
        flex-wrap: wrap;
        /*height: 100vh;*/
        font-family: 'Futura';
        justify-content: center;
        bottom: 0;
        right: 0;
        position: fixed;
        /*transform: rotateZ(180deg);*/
        /* position: absolute; */
    }



    #vis .point.small {
        opacity: 0.1;
        transform: scale(1) !important;
        font-style: normal;
    }

    #vis .point {
        width: 50px;
        justify-content: center;
        height: 50px;
        display: inline-flex;
        font-size: 0.8em;
        align-items: center;
        opacity: 0.2;
        font-weight: 500;
        border-radius: 50%;
        background: white;
        mix-blend-mode: exclusion;
        margin: 4vh;
        background: white;
    }




    #vis .point.big {
        opacity: 0.5;
    }
</style>
